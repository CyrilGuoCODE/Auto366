<!-- 定位窗口 - location.html -->
<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Auto366 - 位置选择</title>
  <link rel="icon" type="image/png" href="icon.png">
  <style>
    body { font-family: Arial, sans-serif; margin: 0; overflow: hidden; background: transparent }
    .marker {
      position: absolute;
      width: 30px;
      height: 30px;
      background-color: red;
      border-radius: 50%;
      cursor: move;
      user-select: none;
      z-index: 10;
    }
    .marker::after {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 10px;
      height: 10px;
      background: white;
      border-radius: 50%;
      transform: translate(-50%, -50%);
    }
    #marker1 { top: 100px; left: 150px; }
    #marker2 { top: 200px; left: 350px; background-color: blue; }
    #confirmBtn {
      position: fixed;
      bottom: 20px;
      right: 20px;
      padding: 10px 20px;
      z-index: 100;
    }
         .instructions-panel {
       position: fixed;
       top: 20px;
       left: 20px;
       background: rgba(0, 0, 0, 0.8);
       color: white;
       padding: 15px;
       border-radius: 8px;
       z-index: 100;
       max-width: 300px;
       cursor: move;
       user-select: none;
     }
    .instructions-panel h3 {
      margin: 0 0 10px 0;
      color: #fff;
    }
    .instructions-panel p {
      margin: 5px 0;
      font-size: 14px;
    }
    .tip {
      color: #ffd700;
      font-style: italic;
    }
  </style>
</head>
<body>
     <div class="instructions-panel">
     <h3>定位说明</h3>
     <p>🔴 <strong>红点</strong>：拖拽到答案输入框位置</p>
     <p>🔵 <strong>蓝点</strong>：拖拽到"下一页"按钮位置</p>
     <p class="tip">提示：确保两个点都准确放置在目标位置，然后点击确定</p>
     <p class="tip">可拖动此面板到其他位置</p>
   </div>
  
  <div id="marker1" class="marker"></div>
  <div id="marker2" class="marker"></div>
  <button id="confirmBtn">确定</button>

     <script>
     const markers = {
       marker1: document.getElementById('marker1'),
       marker2: document.getElementById('marker2')
     };

     let activeMarker = null;
     let offset = { x: 0, y: 0 };

     // 说明面板拖拽功能
     const instructionsPanel = document.querySelector('.instructions-panel');
     let isDraggingPanel = false;
     let panelOffset = { x: 0, y: 0 };

     instructionsPanel.addEventListener('mousedown', (e) => {
       isDraggingPanel = true;
       panelOffset.x = instructionsPanel.offsetLeft - e.clientX;
       panelOffset.y = instructionsPanel.offsetTop - e.clientY;
     });

     // 拖拽功能
     Object.values(markers).forEach(marker => {
       marker.addEventListener('mousedown', (e) => {
         activeMarker = marker;
         offset.x = marker.offsetLeft - e.clientX;
         offset.y = marker.offsetTop - e.clientY;
       });
     });

     document.addEventListener('mousemove', (e) => {
       // 拖拽说明面板
       if (isDraggingPanel) {
         instructionsPanel.style.left = `${e.clientX + panelOffset.x}px`;
         instructionsPanel.style.top = `${e.clientY + panelOffset.y}px`;
         return;
       }

       // 拖拽标记点
       if (!activeMarker) return;

       activeMarker.style.left = `${e.clientX + offset.x}px`;
       activeMarker.style.top = `${e.clientY + offset.y}px`;
     });

     document.addEventListener('mouseup', () => {
       activeMarker = null;
       isDraggingPanel = false;
     });

     // 确认按钮
     document.getElementById('confirmBtn').addEventListener('click', () => {
       const locations = {
         pos1: getPosition(markers.marker1),
         pos2: getPosition(markers.marker2)
       };

       window.electronAPI.setLocations(locations);
       window.close();
     });

     function getPosition(element) {
       const rect = element.getBoundingClientRect();
       return {
         x: Math.round(rect.left + rect.width / 2),
         y: Math.round(rect.top + rect.height / 2)
       };
     }
   </script>
</body>
</html>