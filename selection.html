<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>选择区域</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      background: transparent;
      overflow: hidden;
    }
    #selection-box {
      position: absolute;
      border: 2px dashed #ff0000;
      background-color: rgba(255, 255, 255, 0.2);
      display: none;
    }
    #instructions {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0, 0, 0, 0.7);
      color: white;
      padding: 10px 20px;
      border-radius: 5px;
      font-family: Arial, sans-serif;
    }
  </style>
</head>
<body>
  <div id="selection-box"></div>
  <div id="instructions">拖动鼠标选择区域，释放鼠标完成选择 (ESC取消)</div>

  <script>
    const selectionBox = document.getElementById('selection-box');
    let startX, startY, isSelecting = false;

    document.addEventListener('mousedown', (e) => {
      startX = e.clientX;
      startY = e.clientY;
      isSelecting = true;

      selectionBox.style.left = `${startX}px`;
      selectionBox.style.top = `${startY}px`;
      selectionBox.style.width = '0px';
      selectionBox.style.height = '0px';
      selectionBox.style.display = 'block';
    });

    document.addEventListener('mousemove', (e) => {
      if (!isSelecting) return;

      const currentX = e.clientX;
      const currentY = e.clientY;

      const left = Math.min(startX, currentX);
      const top = Math.min(startY, currentY);
      const width = Math.abs(currentX - startX);
      const height = Math.abs(currentY - startY);

      selectionBox.style.left = `${left}px`;
      selectionBox.style.top = `${top}px`;
      selectionBox.style.width = `${width}px`;
      selectionBox.style.height = `${height}px`;
    });

    document.addEventListener('mouseup', async (e) => {
      if (!isSelecting) return;
      isSelecting = false;

      const endX = e.clientX;
      const endY = e.clientY;

      const rect = {
        x: Math.min(startX, endX),
        y: Math.min(startY, endY),
        width: Math.abs(endX - startX),
        height: Math.abs(endY - startY)
      };

      // 发送选择结果回主窗口
      window.electronAPI.sendSelectionResult(rect);
      window.close();
    });

    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') {
        window.close();
      }
    });
  </script>
</body>
</html>